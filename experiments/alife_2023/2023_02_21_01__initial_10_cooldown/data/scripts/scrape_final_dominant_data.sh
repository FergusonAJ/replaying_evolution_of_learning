#!/bin/bash

IS_REPLAY=1
#REPLAY_SEED=86
#REPLAY_DEPTHS="1000 950 900 850 800 750 700 650 600 550 500 450 400 350 300 250 200 150 100 50"
#REPLAY_DEPTHS="451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480 481 482 483 484 485 486 487 488 489 490 491 492 493 494 495 496 497 498 499"
#REPLAY_DEPTHS="401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449"
#REPLAY_SEED=4
#REPLAY_DEPTHS="1000 950 900 850 800 750 700 650 600 550 500 450 400 350 300 250 200 150 100 50"
#REPLAY_DEPTHS="101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149"
#REPLAY_DEPTHS="51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99"
#REPLAY_SEED=15
#REPLAY_DEPTHS="1000 950 900 850 800 750 700 650 600 550 500 450 400 350 300 250 200 150 100 50"
#REPLAY_DEPTHS="251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299"
REPLAY_SEED=6
#REPLAY_DEPTHS="1000 950 900 850 800 750 700 650 600 550 500 450 400 350 300 250 200 150 100 50"
#REPLAY_DEPTHS="501 502 503 504 505 506 507 508 509 510 511 512 513 514 515 516 517 518 519 520 521 522 523 524 525 526 527 528 529 530 531 532 533 534 535 536 537 538 539 540 541 542 543 544 545 546 547 548 549 550"
#REPLAY_SEED=29
#REPLAY_DEPTHS="1000 950 900 850 800 750 700 650 600 550 500 450 400 350 300 250 200 150 100 50"
#REPLAY_SEED=30
#REPLAY_DEPTHS="2400 2300 2200 2100 2000 1900 1800 1700 1600 1500 1400 1300 1200 1100"
#REPLAY_SEED=94
#REPLAY_DEPTHS="1450 1400 1350 1300 1250 1200 1150 1100 1050"
REPLAY_SEED=100
#REPLAY_DEPTHS="3300 3200 3100 3000 2900 2800 2700 2600 2500 2400 2300 2200 2100 2000 1900 1800 1700 1600 1500 1400 1300 1200 1100"
REPLAY_DEPTHS="1200"
#REPLAY_DEPTHS="1000 950 900 850 800 750 700 650 600 550 500 450 400 350 300 250 200 150 100 50"
    
# Grab the experiment name
EXP_NAME=$(pwd | grep -oP "/\K[^/]+(?=/data|/data/scripts)")

# Grab global config variables
REPO_ROOT_DIR=$(pwd | grep -oP ".+/(?=experiments/)")
source ${REPO_ROOT_DIR}/config_global.sh

# Calculate directories to pass to R script
SCRATCH_REP_DIR=${SCRATCH_ROOT_DIR}/${EXP_NAME}/reps
OUTPUT_DIR=$(pwd | grep -oP ".+/${EXP_NAME}/data")
SCRIPT_DIR=${OUTPUT_DIR}/scripts

if [ $IS_REPLAY -gt 0 ]
then
    for REPLAY_DEPTH in ${REPLAY_DEPTHS}
    do 
        echo "----------------"
        echo "Starting depth: ${REPLAY_DEPTH}"
        REPLAY_SCRATCH_REP_DIR=${SCRATCH_REP_DIR}/${REPLAY_SEED}/replays/${REPLAY_DEPTH}
        REPLAY_OUTPUT_DIR=${OUTPUT_DIR}/reps/${REPLAY_SEED}/replays/${REPLAY_DEPTH}
        mkdir -p ${REPLAY_OUTPUT_DIR}
        echo ""
        echo "Pulling data from: ${REPLAY_SCRATCH_REP_DIR}"
        echo "Saving data to: ${REPLAY_OUTPUT_DIR}"
        echo ""
        Rscript ${SCRIPT_DIR}/combine_final_dominant_data.R ${REPLAY_SCRATCH_REP_DIR} ${REPLAY_OUTPUT_DIR}
    done
else
    echo ""
    echo "Pulling data from: ${SCRATCH_REP_DIR}"
    echo "Saving data to: ${OUTPUT_DIR}"
    echo ""
    Rscript ${SCRIPT_DIR}/combine_final_dominant_data.R ${SCRATCH_REP_DIR} ${OUTPUT_DIR}
fi

